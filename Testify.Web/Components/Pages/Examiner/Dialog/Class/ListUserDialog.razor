@using Testify.Web.Data.Commons
@using Testify.Web.Shared


<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Class="mr-3 mb-n1" />
            Danh sách sinh viên trong lớp
        </MudText>
    </TitleContent>

    <DialogContent>
        <MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6">
            <MudTabPanel Text="Thêm Mới">
                <MudText>
                    <MudText>Selected items (@selectedItems?.Count): @(selectedItems == null ? "" : string.Join(", ", selectedItems.OrderBy(x => x.FullName).Select(x => x.FullName)))</MudText>

                    <MudTable @ref="_table" T="User" Items="@Users" MultiSelection="true" SelectionChangeable="_selectionChangeable" Hover="true"
                              @bind-SelectedItems="selectedItems" OnRowClick="@OnRowClick" SelectOnRowClick="@_selectOnRowClick">
                        <HeaderContent>
                            <MudTh>ID</MudTh>
                            <MudTh>Name</MudTh>
                            <MudTh>Email</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="ID">@context.Id</MudTd>
                            <MudTd DataLabel="Name">@context.FullName</MudTd>
                            <MudTd DataLabel="Email">@context.Email</MudTd>
                        </RowTemplate>
                        <PagerContent>
                            <MudTablePager PageSizeOptions="new int[] { 10, 25, 50, 100 }" />
                        </PagerContent>
                        <FooterContent>
                            <MudTd colspan="4">Select All</MudTd>
                        </FooterContent>
                    </MudTable>
                </MudText>
            </MudTabPanel>
            <MudTabPanel Text="Thêm thủ công">
                <MudText>Thêm thủ công</MudText>
            </MudTabPanel>
        </MudTabs>
    </DialogContent>
</MudDialog>


@code {
    [Parameter]
    public int ClassId { get; set; }

    [CascadingParameter]
    private MudDialogInstance MudDialog { get; set; }

    private HashSet<User> selectedItems = new HashSet<User>();
    private IEnumerable<User> Users = new List<User>();
    private bool _selectOnRowClick = true;
    private bool _selectionChangeable = true;
    private MudTable<User> _table;
    private string _selectedItemText = "No row clicked";

    protected override async Task OnInitializedAsync()
    {
        Users = await _serUser.GetUsersWithStatus(ClassId);
    }

    void OnRowClick(TableRowClickEventArgs<User> args)
    {
        _selectedItemText = $"{args.Item.FullName} ({args.Item.Email})";
    }
}
